String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),geoXML3=window.geoXML3||{instances:[]},geoXML3.parser=function(a){function b(a,b,c){return c=c||function(a){x(a,b)},"function"==typeof ZipFile&&"object"==typeof JSIO&&"function"==typeof JSIO.guessFileType&&(contentType=JSIO.guessFileType(b.baseUrl),contentType==JSIO.FileType.Binary||contentType==JSIO.FileType.Unknown)?(b.isCompressed=!0,b.baseDir=b.baseUrl+"/",void geoXML3.fetchZIP(a,c,b.internals.parser)):(b.isCompressed=!1,b.baseDir=defileURL(b.baseUrl),void geoXML3.fetchXML(a,c))}function c(a){var b=t(w(a,"styleUrl")[0]);if(b&&-1!=b.indexOf("#"))var c=b.split("#");else var c=["",""];return c}function d(a,b,c,d){var f="{inline}"===b?e(r):m[b][c]=m[b][c]||e(r),g=w(a,"BalloonStyle");g&&g.length>0&&(f.balloon.bgColor=t(w(g[0],"bgColor")[0],f.balloon.bgColor),f.balloon.textColor=t(w(g[0],"textColor")[0],f.balloon.textColor),f.balloon.text=t(w(g[0],"text")[0],f.balloon.text),f.balloon.displayMode=t(w(g[0],"displayMode")[0],f.balloon.displayMode));var g=w(a,"IconStyle");if(g&&g.length>0){var h=f.icon;h.scale=parseFloat(t(w(g[0],"scale")[0],h.scale)),g=w(a,"Icon"),g&&g.length>0&&(h.href=t(w(g[0],"href")[0]),h.url=cleanURL(d,h.href),l[h.url]&&(h.url=l[h.url].dataUrl),h.dim={x:parseInt(t(v(g[0],s,"x")[0],h.dim.x)),y:parseInt(t(v(g[0],s,"y")[0],h.dim.y)),w:parseInt(t(v(g[0],s,"w")[0],h.dim.w)),h:parseInt(t(v(g[0],s,"h")[0],h.dim.h))},g=w(a,"hotSpot"),g&&g.length>0&&(h.hotSpot={x:g[0].getAttribute("x"),y:g[0].getAttribute("y"),xunits:g[0].getAttribute("xunits"),yunits:g[0].getAttribute("yunits")}),((h.dim.w<0||h.dim.h<0)&&("pixels"!=h.xunits||"fraction"==h.yunits)||1!=h.scale)&&(h.img=new Image,h.img.onload=function(){(h.dim.w<0||h.dim.h<0)&&(h.dim.w=this.width,h.dim.h=this.height)},h.img.src=h.url,h.img.width>0&&(h.dim.w=h.img.width,h.dim.h=h.img.height)))}return g=w(a,"LineStyle"),g&&g.length>0&&(f.line.color=t(w(g[0],"color")[0],f.line.color),f.line.colorMode=t(w(g[0],"colorMode")[0],f.line.colorMode),f.line.width=t(w(g[0],"width")[0],f.line.width)),g=w(a,"PolyStyle"),g&&g.length>0&&(f.poly.color=t(w(g[0],"color")[0],f.poly.color),f.poly.colorMode=t(w(g[0],"colorMode")[0],f.poly.colorMode),f.poly.outline=u(w(g[0],"outline")[0],f.poly.outline),f.poly.fill=u(w(g[0],"fill")[0],f.poly.fill)),f}function e(a){if(null==a||"object"!=typeof a)return a;if(a.cloneNode)return a.cloneNode(!0);var b=new a.constructor;for(var c in a)b[c]=e(a[c]);return b}function f(a,b,f,g){for(var h=w(a,"Pair"),j=new Object,k=0;k<h.length;k++){var l=t(w(h[k],"key")[0]),n=t(w(h[k],"Style")[0]),o=c(h[k]),p=o[0]?cleanURL(g,o[0]):b,q=o[1];n?j[l]=d(n,p,q):q&&m[p][q]&&(j[l]=e(m[p][q]))}j.normal?m[b][f]=e(j.normal):m[b][f]=e(r),j.highlight&&i.processStyles&&A(j.highlight),m[b][f].map=e(j)}function g(a,b){for(var c=w(a,b),d=[],e=0;e<c.length;e++){var f=w(c[e],"coordinates");if(!f){if(d.length>0)break;return[{coordinates:[]}]}for(var g=0;g<f.length;g++){var h=t(f[g]).trim();h=h.replace(/,\s+/g,",");for(var i=h.split(/\s+/g),j=i.length,k=[],l=0;j>l;l++)h=i[l].split(","),isNaN(h[0])||isNaN(h[1])||k.push({lat:parseFloat(h[1]),lng:parseFloat(h[0]),alt:parseFloat(h[2])});d.push({coordinates:k})}}return d}google.maps.MVCObject.call(this);var h,i=new geoXML3.parserOptions(a),j=[],k={},l={},m={};!i.infoWindow&&i.singleInfoWindow&&(i.infoWindow=new google.maps.InfoWindow);var n=function(a,b){var c={parser:this,docSet:b||[],remaining:1,parseOnly:!(i.afterParse||i.processStyles)};thisDoc=new Object,thisDoc.internals=c,c.docSet.push(thisDoc),x(geoXML3.xmlParse(a),thisDoc)},o=function(a,c){h||(h="geoXML3.instances["+(geoXML3.instances.push(this)-1)+"]"),"string"==typeof a&&(a=[a]);for(var d,e={parser:this,docSet:c||[],remaining:a.length,parseOnly:!(i.afterParse||i.processStyles)},f=0;f<a.length;f++){var g=cleanURL(defileURL(location.pathname),a[f]);k[g]?(d=k[g],d.reload=!0):(d=new Object,d.baseUrl=g,e.docSet.push(d)),d.url=a[f],d.internals=e,b(d.url,d)}},p=function(a){a||(a=j[0]);var b;if(a.markers)for(b=0;b<a.markers.length;b++)a.markers[b].infoWindow&&a.markers[b].infoWindow.close(),a.markers[b].setVisible(!1);if(a.ggroundoverlays)for(b=0;b<a.ggroundoverlays.length;b++)a.ggroundoverlays[b].setOpacity(0);if(a.gpolylines)for(b=0;b<a.gpolylines.length;b++)a.gpolylines[b].infoWindow&&a.gpolylines[b].infoWindow.close(),a.gpolylines[b].setMap(null);if(a.gpolygons)for(b=0;b<a.gpolygons.length;b++)a.gpolygons[b].infoWindow&&a.gpolygons[b].infoWindow.close(),a.gpolygons[b].setMap(null)},q=function(a){a||(a=j[0]);var b;if(a.markers)for(b=0;b<a.markers.length;b++)a.markers[b].setVisible(!0);if(a.ggroundoverlays)for(b=0;b<a.ggroundoverlays.length;b++)a.ggroundoverlays[b].setOpacity(a.ggroundoverlays[b].percentOpacity_);if(a.gpolylines)for(b=0;b<a.gpolylines.length;b++)a.gpolylines[b].setMap(i.map);if(a.gpolygons)for(b=0;b<a.gpolygons.length;b++)a.gpolygons[b].setMap(i.map)},r={balloon:{bgColor:"ffffffff",textColor:"ff000000",text:"<h3>$[name]</h3>\n<div>$[description]</div>\n<div>$[geDirections]</div>",displayMode:"default"},icon:{scale:1,dim:{x:0,y:0,w:-1,h:-1},hotSpot:{x:.5,y:.5,xunits:"fraction",yunits:"fraction"}},line:{color:"ffffffff",colorMode:"normal",width:1},poly:{color:"ffffffff",colorMode:"normal",fill:!0,outline:!0}},s="http://www.google.com/kml/ext/2.2",t=geoXML3.nodeValue,u=geoXML3.getBooleanValue,v=geoXML3.getElementsByTagNameNS,w=geoXML3.getElementsByTagName,x=function(a,n){if(!a)return geoXML3.log("Unable to retrieve "+n.url),i.failedParse&&i.failedParse(n),void(n.failed=!0);if(a.parseError&&0!=a.parseError.errorCode){var o=a.parseError,p="Parse error in line "+o.line+", col "+o.linePos+" (error code: "+o.errorCode+")\n\nError Reason: "+o.reason+"Error Line: "+o.srcText;return geoXML3.log("Unable to retrieve "+n.url+": "+p),i.failedParse&&i.failedParse(n),void(n.failed=!0)}if(a.documentElement&&"parsererror"==a.documentElement.nodeName)return geoXML3.log("Unable to retrieve "+n.url+": "+a.documentElement.childNodes[0].nodeValue),i.failedParse&&i.failedParse(n),void(n.failed=!0);if(!n)throw"geoXML3 internal error: render called with null document";var q;n.placemarks=[],n.groundoverlays=[],n.ggroundoverlays=[],n.networkLinks=[],n.gpolygons=[],n.gpolylines=[];for(var y=w(a,"styleUrl"),z=n.internals.docSet,q=0;q<y.length;q++){var G=t(y[q]).split("#")[0];if(G){var H=cleanURL(n.baseDir,G);if(H!==n.baseUrl&&!k[H]){var I,J=z.indexOfObjWithItem("baseUrl",H);if(-1!=J){if(I=z[J],I.failed)continue}else I=new Object,I.url=H,I.baseUrl=H,I.internals=n.internals,n.internals.docSet.push(I),n.internals.remaining++;return void b(H,I,function(b){x(b,I),x(a,n)})}}}n.styles=m[n.baseUrl]=m[n.baseUrl]||{};var K;for(y=w(a,"Style"),nodeCount=y.length,q=0;q<nodeCount;q++){thisNode=y[q];var K=thisNode.getAttribute("id");K&&d(thisNode,n.baseUrl,K,n.baseDir)}for(y=w(a,"StyleMap"),q=0;q<y.length;q++){thisNode=y[q];var K=thisNode.getAttribute("id");K&&f(thisNode,n.baseUrl,K,n.baseDir)}if((i.processStyles||!i.createMarker)&&B(n),n.reload&&n.markers)for(q=0;q<n.markers.length;q++)n.markers[q].active=!1;var L,M,N,O,P,N,Q,R,S=w(a,"Placemark");for(pm=0;pm<S.length;pm++){M=S[pm];var T=c(M);L={name:t(w(M,"name")[0]),description:t(w(M,"description")[0]),styleUrl:T.join("#"),styleBaseUrl:T[0]?cleanURL(n.baseDir,T[0]):n.baseUrl,styleID:T[1],visibility:u(w(M,"visibility")[0],!0),balloonVisibility:u(v(M,s,"balloonVisibility")[0],!i.suppressInfoWindows),id:M.getAttribute("id")},L.style=m[L.styleBaseUrl]&&m[L.styleBaseUrl][L.styleID]||e(r);var U=w(M,"Style");if(U&&U.length>0){var V=d(M,"{inline}","{inline}");A(V),V&&(L.style=V)}/^https?:\/\//.test(L.description)&&(L.description=['<a href="',L.description,'">',L.description,"</a>"].join("")),L.vars={display:{name:"Name",description:"Description",address:"Street Address",id:"ID",Snippet:"Snippet",geDirections:"Directions"},val:{name:L.name||"",description:L.description||"",address:t(w(M,"address")[0],""),id:M.getAttribute("id")||"",Snippet:t(w(M,"Snippet")[0],"")},directions:["f=d","source=GeoXML3"]};var W=w(M,"ExtendedData");if(W&&W.length>0)for(var X=w(W[0],"Data"),Y=0;Y<X.length;Y++){var Z=X[Y],$=Z.getAttribute("name");if($){var _=t(w(Z,"displayName")[0],$),aa=t(w(Z,"value")[0]);L.vars.val[$]=aa,L.vars.display[$]=_}}var ba=w(M,"coordinates"),ca=null;if(ba&&ba.length>0)for(var da=0;da<ba.length;da++)if(ba[da].parentNode&&ba[da].parentNode.nodeName){var ea=ba[da].parentNode;switch(ca=ea.nodeName){case"Point":L.Point=g(M,"Point")[0],L.latlng=new google.maps.LatLng(L.Point.coordinates[0].lat,L.Point.coordinates[0].lng),P=1;break;case"LinearRing":Q=w(M,"Polygon"),L.Polygon||(L.Polygon=[{outerBoundaryIs:{coordinates:[]},innerBoundaryIs:[{coordinates:[]}]}]);for(var fa=0;fa<Q.length;fa++)L.Polygon[fa]={outerBoundaryIs:{coordinates:[]},innerBoundaryIs:[{coordinates:[]}]},L.Polygon[fa].outerBoundaryIs=g(Q[fa],"outerBoundaryIs"),L.Polygon[fa].innerBoundaryIs=g(Q[fa],"innerBoundaryIs");R=L.Polygon[0].outerBoundaryIs;break;case"LineString":P=0,L.LineString=g(M,"LineString")}}if(i.pmParseFn&&i.pmParseFn(M,L),n.placemarks.push(L),L.Point){google.maps&&(n.bounds=n.bounds||new google.maps.LatLngBounds,n.bounds.extend(L.latlng));var ga=i.createMarker||C,ha=!1;if(!i.createMarker&&n&&(n.markers=n.markers||[],n.reload))for(var J=0;J<n.markers.length;J++)if(n.markers[J].id==L.id||!n.markers[J].id&&n.markers[J].getPosition().equals(L.latlng)){ha=n.markers[J].active=!0;break}if(!ha){var N=ga(L,n);N&&(N.active=L.visibility,N.id=L.id)}}var O,ia;n&&(L.Polygon&&(n.gpolygons=n.gpolygons||[]),L.LineString&&(n.gpolylines=n.gpolylines||[]));var ja=i.createPolygon||F,ka=i.createLineString||E;L.Polygon&&(O=ja(L,n),O&&(O.active=L.visibility)),L.LineString&&(ia=ka(L,n),ia&&(ia.active=L.visibility)),google.maps&&(n.bounds=n.bounds||new google.maps.LatLngBounds,O&&n.bounds.union(O.bounds),ia&&n.bounds.union(ia.bounds))}if(n.reload&&n.markers)for(q=n.markers.length-1;q>=0;q--)n.markers[q].active||(n.markers[q].infoWindow&&n.markers[q].infoWindow.close(),n.markers[q].setMap(null),n.markers.splice(q,1));if(n.reload&&n.groundoverlays)for(q=0;q<n.groundoverlays.length;q++)n.groundoverlays[q].active=!1;n&&(n.groundoverlays=n.groundoverlays||[]);var la,ma,na=w(a,"GroundOverlay");for(q=0;q<na.length;q++){M=na[q];var oa=cleanURL(n.baseDir,t(w(M,"href")[0]));l[oa]&&(oa=l[oa].dataUrl),la={name:t(w(M,"name")[0]),description:t(w(M,"description")[0]),icon:{href:oa},latLonBox:{north:parseFloat(t(w(M,"north")[0])),east:parseFloat(t(w(M,"east")[0])),south:parseFloat(t(w(M,"south")[0])),west:parseFloat(t(w(M,"west")[0]))}},google.maps&&(n.bounds=n.bounds||new google.maps.LatLngBounds,n.bounds.union(new google.maps.LatLngBounds(new google.maps.LatLng(la.latLonBox.south,la.latLonBox.west),new google.maps.LatLng(la.latLonBox.north,la.latLonBox.east))));var pa=w(M,"color");if(pa&&pa.length>0?la.opacity=geoXML3.getOpacity(t(pa[0])):la.opacity=1,n.groundoverlays.push(la),i.createOverlay)i.createOverlay(la,n);else{var ha=!1;if(n&&(n.groundoverlays=n.groundoverlays||[],n.reload)){overlayBounds=new google.maps.LatLngBounds(new google.maps.LatLng(la.latLonBox.south,la.latLonBox.west),new google.maps.LatLng(la.latLonBox.north,la.latLonBox.east));var qa=n.groundoverlays;for(q=qa.length;q--;)if(qa[q].bounds().equals(overlayBounds)&&qa.url_===la.icon.href){ha=qa[q].active=!0;break}}ha||(ma=D(la,n),ma.active=!0)}if(n.reload&&n.groundoverlays&&n.groundoverlays.length){var qa=n.groundoverlays;for(q=qa.length;q--;)qa[q].active||(qa[q].remove(),qa.splice(q,1));n.groundoverlays=qa}}var ra,sa=document.location.pathname.split("/");sa=sa.splice(0,sa.length-1).join("/");var ta=w(a,"NetworkLink");for(q=0;q<ta.length;q++)M=ta[q],ra={name:t(w(M,"name")[0]),link:{href:t(w(M,"href")[0]),refreshMode:t(w(M,"refreshMode")[0])}},ra.link.refreshMode||(ra.link.refreshMode="onChange"),"onInterval"===ra.link.refreshMode?(ra.link.refreshInterval=parseFloat(t(w(M,"refreshInterval")[0])),isNaN(ra.link.refreshInterval)&&(ra.link.refreshInterval=0)):"onChange"===ra.link.refreshMode&&(ra.link.viewRefreshMode=t(w(M,"viewRefreshMode")[0]),ra.link.viewRefreshMode||(ra.link.viewRefreshMode="never"),"onStop"===ra.link.viewRefreshMode&&(ra.link.viewRefreshTime=t(w(M,"refreshMode")[0]),ra.link.viewFormat=t(w(M,"refreshMode")[0]),ra.link.viewFormat||(ra.link.viewFormat="BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]"))),/^[\/|http]/.test(ra.link.href)||(ra.link.href=sa+"/"+ra.link.href),"onInterval"===ra.link.refreshMode&&ra.link.refreshInterval>0?setInterval(h+'.parse("'+ra.link.href+'")',1e3*ra.link.refreshInterval):"onChange"===ra.link.refreshMode&&("never"===ra.link.viewRefreshMode?n.internals.parser.parse(ra.link.href,n.internals.docSet):"onStop"===ra.link.viewRefreshMode);if(n.bounds&&(n.internals.bounds=n.internals.bounds||new google.maps.LatLngBounds,n.internals.bounds.union(n.bounds)),(n.markers||n.groundoverlays||n.gpolylines||n.gpolygons)&&(n.internals.parseOnly=!1),!n.internals.parseOnly)if(k[n.baseUrl])for(var q in k[n.baseUrl])k[n.baseUrl][q]=n[q];else j.push(n),k[n.baseUrl]=n;n.internals.remaining--,0===n.internals.remaining&&(i.zoom&&n.internals.bounds&&!n.internals.bounds.isEmpty()&&i.map&&i.map.fitBounds(n.internals.bounds),i.afterParse&&i.afterParse(n.internals.docSet),google.maps.event.trigger(n.internals.parser,"parsed"))},y=function(a,b){var c={};a=a||"ffffffff";var d=a.substr(0,2),e=a.substr(2,2),f=a.substr(4,2),g=a.substr(6,2);return c.opacity=parseInt(d,16)/256,c.color="random"===b?z(g,f,e):"#"+g+f+e,c},z=function(a,b,c){var d={rr:a,gg:b,bb:c};for(var e in d){var f=d[e];null==f&&(f="ff"),f=Math.round(Math.random()*parseInt(a,16)).toString(16),1===f.length&&(f="0"+f),d[e]=f}return"#"+d.rr+d.gg+d.bb},A=function(a){var b=a.icon;if(b.href){if(b.img&&!b.img.complete&&b.dim.w<0&&b.dim.h<0)return b.markerBacklog=[],void(b.img.onload=function(){(b.dim.w<0||b.dim.h<0)&&(b.dim.w=this.width,b.dim.h=this.height),A(a);for(var c=0;c<b.markerBacklog.length;c++){var d=b.markerBacklog[c][0],e=b.markerBacklog[c][1];C(d,e),d.marker&&(d.marker.active=!0)}delete b.markerBacklog});(b.dim.w<0||b.dim.h<0)&&(b.img&&b.img.complete?(b.dim.w=b.img.width,b.dim.h=b.img.height):(b.dim.whGuess=!0,b.dim.w=32,b.dim.h=32));var c,d,e=Math.round,f={x:b.dim.x*b.scale,y:b.dim.y*b.scale,w:b.dim.w*b.scale,h:b.dim.h*b.scale,aX:b.hotSpot.x*b.scale,aY:b.hotSpot.y*b.scale,iW:(b.img?b.img.width:b.dim.w)*b.scale,iH:(b.img?b.img.height:b.dim.h)*b.scale};switch(b.hotSpot.xunits){case"fraction":c=e(f.aX*b.dim.w);break;case"insetPixels":c=e(b.dim.w*b.scale-f.aX);break;default:c=e(f.aX)}d=f.h-e(("fraction"===b.hotSpot.yunits?b.dim.h:1)*f.aY);var g=new google.maps.Point(c,d),h=b.dim.whGuess?null:new google.maps.Size(e(f.w),e(f.h)),i=1==b.scale?null:b.dim.whGuess?new google.maps.Size(e(f.w),e(f.h)):new google.maps.Size(e(f.iW),e(f.iH)),j=new google.maps.Point(e(f.x),e(f.y));l[b.url]&&(b.url=l[b.url].dataUrl),b.marker={url:b.url,size:h,origin:j,anchor:g,scaledSize:i};var k=/\/(red|blue|green|yellow|lightblue|purple|pink|orange)(-dot)?\.png/,m=new google.maps.Size(59,32),n=new google.maps.Point(16,32);k.test(b.href)?b.shadow={url:"http://maps.google.com/mapfiles/ms/micons/msmarker.shadow.png",size:m,origin:null,anchor:n,scaledSize:m}:b.href.indexOf("-pushpin.png")>-1&&(b.shadow={url:"http://maps.google.com/mapfiles/ms/micons/pushpin_shadow.png",size:m,origin:null,anchor:n,scaledSize:m})}},B=function(a){for(var b in a.styles)A(a.styles[b])},C=function(a,b){var c=a.style.icon;if(!c.marker&&c.img)return c.markerBacklog=c.markerBacklog||[],void c.markerBacklog.push([a,b]);var d=geoXML3.combineOptions(i.markerOptions,{map:i.map,position:new google.maps.LatLng(a.Point.coordinates[0].lat,a.Point.coordinates[0].lng),title:a.name,zIndex:Math.round(-1e5*a.Point.coordinates[0].lat)<<5,icon:c.marker,shadow:c.shadow,flat:!c.shadow,visible:a.visibility}),e=new google.maps.Marker(d);return b&&b.markers.push(e),G(a,b,e),a.marker=e,e},D=function(a,b){if(!window.ProjectedOverlay)throw"geoXML3 error: ProjectedOverlay not found while rendering GroundOverlay from KML";var c=new google.maps.LatLngBounds(new google.maps.LatLng(a.latLonBox.south,a.latLonBox.west),new google.maps.LatLng(a.latLonBox.north,a.latLonBox.east)),d=geoXML3.combineOptions(i.overlayOptions,{percentOpacity:100*a.opacity}),e=new ProjectedOverlay(i.map,a.icon.href,c,d);return b&&(b.ggroundoverlays=b.ggroundoverlays||[],b.ggroundoverlays.push(e)),e},E=function(a,b){for(var c=[],d=new google.maps.LatLngBounds,e=0;e<a.LineString.length;e++)for(var f=a.LineString[e].coordinates,g=0;g<f.length;g++){var h=new google.maps.LatLng(f[g].lat,f[g].lng);c.push(h),d.extend(h)}var j=(c[Math.floor(c.length/2)],y(a.style.line.color,a.style.line.colorMode)),k=geoXML3.combineOptions(i.polylineOptions,{map:i.map,path:c,strokeColor:j.color,strokeWeight:a.style.line.width,strokeOpacity:j.opacity,title:a.name,visible:a.visibility}),l=new google.maps.Polyline(k);return l.bounds=d,G(a,b,l),b&&b.gpolylines.push(l),a.polyline=l,l},F=function(a,b){for(var c=new google.maps.LatLngBounds,d=0,e=[],f=0;f<a.Polygon.length;f++){for(var g=0;g<a.Polygon[f].outerBoundaryIs.length;g++){for(var h=a.Polygon[f].outerBoundaryIs[g].coordinates,j=[],k=0;k<h.length;k++){var l=new google.maps.LatLng(h[k].lat,h[k].lng);j.push(l),c.extend(l)}e.push(j),d+=j.length}for(var g=0;g<a.Polygon[f].innerBoundaryIs.length;g++){for(var h=a.Polygon[f].innerBoundaryIs[g].coordinates,j=[],k=0;k<h.length;k++){var l=new google.maps.LatLng(h[k].lat,h[k].lng);j.push(l),c.extend(l)}e.push(j),d+=j.length}}var m=y(a.style.line.color,a.style.line.colorMode),n=y(a.style.poly.color,a.style.poly.colorMode);a.style.poly.fill||(n.opacity=0);var o=a.style.line.width;a.style.poly.outline||(o=0,m.opacity=0);var p=geoXML3.combineOptions(i.polygonOptions,{map:i.map,paths:e,title:a.name,strokeColor:m.color,strokeWeight:o,strokeOpacity:m.opacity,fillColor:n.color,fillOpacity:n.opacity,visible:a.visibility}),q=new google.maps.Polygon(p);return q.bounds=c,G(a,b,q),b&&b.gpolygons.push(q),a.polygon=q,q},G=function(a,b,c){var d=a.style.balloon,e=a.vars;if(a.balloonVisibility&&"hide"!==d.displayMode){if(!a.latlng||i.suppressDirections&&i.suppressDirections)e.val.geDirections="";else{e.directions.push("sll="+a.latlng.toUrlValue());var f="http://maps.google.com/maps?"+e.directions.join("&"),g=encodeURIComponent(e.val.address||a.latlng.toUrlValue()).replace(/\%20/g,"+");e.val.geDirections='<a href="'+f+"&daddr="+g+'" target=_blank>To Here</a> - <a href="'+f+"&saddr="+g+'" target=_blank>From Here</a>'}var h=d.text.replace(/\$\[(\w+(\/displayName)?)\]/g,function(a,b,c){return c?e.display[b]:e.val[b]}),j="geoxml3_infowindow geoxml3_style_"+a.styleID,k=[];"ffffffff"!=d.bgColor&&k.push("background: "+y(d.bgColor).color+";"),"ff000000"!=d.textColor&&k.push("color: "+y(d.textColor).color+";");var m=k.length?' style="'+k.join(" ")+'"':"",n=geoXML3.combineOptions(i.infoWindowOptions,{content:'<div class="'+j+'"'+m+">"+h+"</div>",pixelOffset:new google.maps.Size(0,2)});c.infoWindow=i.infoWindow||new google.maps.InfoWindow(n),c.infoWindowOptions=n,google.maps.event.addListener(c,"click",function(a){var c=this.infoWindow;c.close(),c.setOptions(this.infoWindowOptions),a&&a.latLng?c.setPosition(a.latLng):this.bounds&&c.setPosition(this.bounds.getCenter()),c.setContent("<div id='geoxml3_infowindow'>"+c.getContent()+"</div>"),google.maps.event.addListenerOnce(c,"domready",function(){for(var a=document.getElementById("geoxml3_infowindow"),c=a.getElementsByTagName("img"),d=0;d<c.length;d++){var e=c[d].getAttribute("src"),f=cleanURL(b.baseDir,e);l[f]?c[d].src=l[f].dataUrl:l[e]&&(c[d].src=l[e].dataUrl)}}),c.open(this.map,this.bounds?null:this)})}};return{options:i,docs:j,docsByUrl:k,kmzMetaData:l,parse:o,render:x,parseKmlString:n,hideDocument:p,showDocument:q,processStyles:B,createMarker:C,createOverlay:D,createPolyline:E,createPolygon:F}},geoXML3.getOpacity=function(a){if(a&&""!==a&&8==a.length){var b=parseInt(a.substr(0,2),16);return b/255}return 1},geoXML3.log=function(a){window.console?console.log(a):alert("log:"+a)},geoXML3.parserOptions=function(a){if(this.map=null,this.zoom=!0,this.singleInfoWindow=!1,this.suppressInfoWindows=!1,this.processStyles=!1,this.markerOptions={},this.infoWindowOptions={},this.overlayOptions={},this.afterParse=null,this.failedParse=null,this.createMarker=null,this.createOverlay=null,a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);return this},geoXML3.combineOptions=function(a,b){var c={};if(a)for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);if(b)for(d in b)b.hasOwnProperty(d)&&void 0===c[d]&&(c[d]=b[d]);return c},geoXML3.parserOptions.prototype.combineOptions=geoXML3.combineOptions,geoXML3.fetchers=[],geoXML3.xmlParse=function(a){if("undefined"!=typeof ActiveXObject&&"undefined"!=typeof GetObject){var b=new ActiveXObject("Microsoft.XMLDOM");return b.loadXML(a),b}return"undefined"!=typeof DOMParser?(new DOMParser).parseFromString(a,"text/xml"):createElement("div",null)},geoXML3.fetchXML=function(a,b){function c(){b()}var d=new Object;if(geoXML3.fetchers.length)d=geoXML3.fetchers.pop();else if(window.XMLHttpRequest)d.fetcher=new window.XMLHttpRequest;else if(window.ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP","MSXML.XMLHTTP"],f=0;f<e.length;f++)try{d.fetcher=new ActiveXObject(e[f]);break}catch(g){continue}if(!d.fetcher)return geoXML3.log("Unable to create XHR object"),b(null),null}return d.fetcher.overrideMimeType&&d.fetcher.overrideMimeType("text/xml"),d.fetcher.open("GET",a,!0),d.fetcher.onreadystatechange=function(){if(4===d.fetcher.readyState){if(d.xhrtimeout&&clearTimeout(d.xhrtimeout),d.fetcher.status>=400)geoXML3.log("HTTP error "+d.fetcher.status+" retrieving "+a),b();else if(d.fetcher.responseXML){var c=d.fetcher.responseXML;!c||c.documentElement||c.ownerElement||c.loadXML(d.fetcher.responseText),b(c)}else b(geoXML3.xmlParse(d.fetcher.responseText));geoXML3.fetchers.push(d)}},d.xhrtimeout=setTimeout(c,6e4),d.fetcher.send(null),null};var IEversion=function(){var a=-1;if("Microsoft Internet Explorer"==navigator.appName){var b=navigator.userAgent,c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=c.exec(b)&&(a=parseFloat(RegExp.$1))}return a};geoXML3.fetchZIP=function(a,b,c){new ZipFile(a,function(d){for(var e=0;e<d.status.length;e++){var f=d.status[e];if(0==f.indexOf("ERROR"))return geoXML3.log("HTTP/ZIP error retrieving "+a+": "+f),void b();0==f.indexOf("WARNING")&&geoXML3.log("HTTP/ZIP warning retrieving "+a+": "+f)}for(var g,h=0,e=0;e<d.entries.length;e++){var i=d.entries[e].name;/\.kml$/.test(i)&&(h++,1==h?g=e:geoXML3.log("KMZ warning retrieving "+a+': found extra KML "'+i+'" in KMZ; discarding...'))}for(var j=cleanURL(defileURL(a),a)+"/",k={timer:null,extractLeft:0,timerCalls:0},l=function(a,d){var e=cleanURL(j,a.name),f=a.name.substring(a.name.lastIndexOf(".")+1).toLowerCase();if(k.extractLeft--,"string"==typeof d.description&&"Error"==d.name)return geoXML3.log("KMZ error extracting "+e+": "+d.description),void b();var g;"jpg"===f&&(f="jpeg"),g=/^(gif|jpeg|png)$/.test(f)?"image/"+f:"mp3"===f?"audio/mpeg":"m4a"===f?"audio/mp4":"m4a"===f?"audio/MP4-LATM":"application/octet-stream",c.kmzMetaData[e]={},c.kmzMetaData[e].entry=a,c.kmzMetaData[e].dataUrl="data:"+g+";base64,"+base64Encode(d),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&(IEversion()<8&&c.kmzMetaData[e].dataUrl.length>2071||9>IEversion&&c.kmzMetaData[e].dataUrl.length>32767)&&(c.kmzMetaData[e].dataUrl="data:image/gif;base64,R0lGODlhDwAQAOMPADBPvSpQ1Dpoyz1p6FhwvU2A6ECP63CM04CWxYCk+V6x+UK++Jao3rvC3fj7+v///yH5BAEKAA8ALAAAAAAPABAAAASC8Mk5mwCAUMlWwcLRHEelLAoGDMgzSsiyGCAhCETDPMh5XQCBwYBrNBIKWmg0MCQHj8MJU5IoroYCY6AAAgrDIbbQDGIK6DR5UPhlNo0JAlSUNAiDgH7eNAxEDWAKCQM2AAFheVxYAA0AIkFOJ1gBcQQaUQKKA5w7LpcEBwkJaKMUEQA7"),c.kmzMetaData[internalSrc(a.name)]=c.kmzMetaData[e]},m=function(c,d){return"string"==typeof d.description&&"Error"==d.name?(geoXML3.log("KMZ error extracting "+mdUrl+": "+d.description),void b()):(clearTimeout(k.timer),k.extractLeft<=1?(k.extractLeft--,void b(geoXML3.xmlParse(d))):(k.timerCalls++,void(k.timerCalls<100?k.timer=setTimeout(function(){m(c,d)},100):(geoXML3.log("KMZ warning extracting "+a+": entire ZIP has not been extracted after 10 seconds; running through KML, anyway..."),k.extractLeft--,b(geoXML3.xmlParse(d))))))},e=0;e<d.entries.length;e++){var n=d.entries[e],o=n.name.substring(n.name.lastIndexOf(".")+1).toLowerCase();/^(gif|jpe?g|png|kml)$/.test(o)&&("kml"!==o||e==g)&&(c||"kml"==o)&&(k.extractLeft++,n.extract("kml"===o?m:l))}})},geoXML3.nodeValue=function(a,b){var c="";if(!a)return"undefined"==typeof b||null===b?null:b;if(3==a.nodeType||4==a.nodeType||2==a.nodeType)c+=a.nodeValue;else if(1==a.nodeType||9==a.nodeType||11==a.nodeType)for(var d=0;d<a.childNodes.length;++d)c+=arguments.callee(a.childNodes[d]);return c},geoXML3.getBooleanValue=function(a,b){var c=geoXML3.nodeValue(a);return null===c?b||!1:(c=parseInt(c),isNaN(c)?!0:0==c?!1:!0)},geoXML3.getElementsByTagNameNS=function(a,b,c){if(a&&"undefined"!=typeof a.getElementsByTagNameNS)return a.getElementsByTagNameNS(b,c);if(!a)return[];var d=a.documentElement||a.ownerDocument&&a.ownerDocument.documentElement;if(!d||!d.attributes)return[];for(var e=0;e<d.attributes.length;e++){var f=d.attributes[e];if("xmlns"===f.prefix&&f.nodeValue===b)return a.getElementsByTagName(f.baseName+":"+c);if("xmlns"===f.nodeName&&f.nodeValue===b)return"undefined"!=typeof a.selectNodes?(d.ownerDocument.getProperty("SelectionNamespaces")||d.ownerDocument.setProperty("SelectionNamespaces","xmlns:defaultNS='"+b+"'"),a.selectNodes(".//defaultNS:"+c)):(d.setAttribute("xmlns:defaultNS",b),a.getElementsByTagName("defaultNS:"+c))}return geoXML3.getElementsByTagName(a,c)},geoXML3.getElementsByTagName=function(a,b){return a.getElementsByTagName(a&&"undefined"!=typeof a.getElementsByTagNameNS?b:b)};var toAbsURL=function(a,b){var c,d,e,f=location.protocol+"://"+location.host;if(!b.length)return"";if(/^\w+:/.test(b))return b;if(0==b.indexOf("/"))return f+b;if(c=a.replace(/\/[^\/]*$/,""),d=b.match(/\.\.\//g))for(b=b.substring(3*d.length),e=d.length;e--;)c=c.substring(0,c.lastIndexOf("/"));return f+c+"/"+b},internalSrc=function(a){var b=document.location.href;b=b.substring(0,b.lastIndexOf("/")+1);var c=b+a;return c},dehostURL=function(a){var b=location.protocol+"://"+location.host;return b=b.replace(/([\.\\\+\*\?\[\^\]\$\(\)])/g,"\\$1"),a.replace(new RegExp("^"+b,"i"),"")},cleanURL=function(a,b){return dehostURL(toAbsURL(a?a.split("#")[0].split("?")[0]:defileURL(location.pathname),b?b.split("#")[0].split("?")[0]:""))},defileURL=function(a){return a?a.substr(0,a.lastIndexOf("/")+1):"/"};Array.prototype.hasObject=Array.indexOf?function(a){return-1!==this.indexOf(a)}:function(a){for(var b=this.length+1;b--;)if(this[b-1]===a)return!0;return!1},Array.prototype.hasItemInObj=function(a,b){for(var c=this.length+1;c--;)if(this[c-1][a]===b)return!0;return!1},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){null==b?b=0:0>b&&(b=Math.max(0,this.length+b));for(var c=b,d=this.length;d>c;c++)if(this[c]===a)return c;return-1}),Array.prototype.indexOfObjWithItem=function(a,b,c){null==c?c=0:0>c&&(c=Math.max(0,this.length+c));for(var d=c,e=this.length;e>d;d++)if(this[d][a]===b)return d;return-1};var base64Encode=function(a){for(var b,c,d,e,f,g,h,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",j="",k=0;k<a.length;)b=a[k++],c=a[k++],d=a[k++],e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,void 0==c?g=h=64:void 0==d&&(h=64),j=j+i.charAt(e)+i.charAt(f)+i.charAt(g)+i.charAt(h);return j};angular.module("wardMapApp",["ngAnimate","ngRoute","ngSanitize","ui.sortable","uiGmapgoogle-maps","ngStorage","ngGrid","angularSpectrumColorpicker"]).config(["$routeProvider",function(a){a.when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/regions",{templateUrl:"views/regions.html",controller:"regionCtrl"}).when("/analyze",{templateUrl:"views/analyze.html",controller:"AnalyzeCtrl"}).otherwise({templateUrl:"views/households.html",controller:"householdsCtrl"})}]),angular.module("wardMapApp").controller("householdsCtrl",["$scope","peopleService","geocoderService",function(a,b,c){function d(){if(b.people.length){var c=b.people[0],d=[];for(var e in c){var f={field:e,displayName:e};d.push(f)}a.tableColumns=d}}a.people=b.people,a.households=b.households,a.bounds={northeast:{latitude:null,longitude:null},southwest:{latitude:null,longitude:null}},a.rowClick=function(a){console.log(a)},a.tableColumns=[{field:"name",displayName:"Name"},{field:"address1",displayName:"Address"},{field:"phone",displayName:"Phone"},{field:"email",displayName:"E-mail"},{field:"formattedAddress",displayName:"Geocoded Address"},{field:"geocodeType",displayName:"Geocode Type"}],a.gridOptions={data:"people",showColumnMenu:!0,rowTemplate:'<div ng-click="rowClick(row.entity)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}">\r\n	<div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div>\r\n	<div ng-cell></div>\r\n</div>',columnDefs:"tableColumns"},a.geocoding=!1,a.geocodingIndex=0,a.geocodingTotal=0,a.geocodingSuccess=0,a.geocodingFail=0,a.onError=function(a){alert(a)},a.clearGeocodes=function(){c.purge()},a.onComplete=function(){d();var e=b.households,f=null;a.geocoding=!0,a.geocodingTotal=Object.keys(e).length;for(var g in e){var h=typeof e[g];if("object"===h){var i=e[g];c.geocodeAddress(i.address1,g).then(function(c){var d=b.households[c.id];d.formattedAddress=c.formattedAddress,d.geocodeType=c.types,d.geocodePartial=c.partial,d.latitude=c.latitude,d.longitude=c.longitude,d.icon="http://maps.google.com/mapfiles/kml/paddle/blu-blank-lv.png";var e=new google.maps.LatLng(c.latitude,c.longitude);null==f?f=new google.maps.LatLngBounds(e,e):f.extend(e),a.geocodingIndex++,a.geocodingSuccess++,a.geocodingIndex==a.geocodingTotal-1&&(a.geocoding=!1,a.bounds.northeast.latitude=f.getNorthEast().lat(),a.bounds.northeast.longitude=f.getNorthEast().lng(),a.bounds.southwest.latitude=f.getSouthWest().lat(),a.bounds.southwest.longitude=f.getSouthWest().lng())},function(c){var d=b.households[c.id];d.error=c,a.geocodingIndex++,a.geocodingFail++,a.geocodingIndex==a.geocodingTotal-1&&(a.geocoding=!1,a.bounds.northeast.latitude=f.getNorthEast().lat(),a.bounds.northeast.longitude=f.getNorthEast().lng(),a.bounds.southwest.latitude=f.getSouthWest().lat(),a.bounds.southwest.longitude=f.getSouthWest().lng())})}}}}]),angular.module("wardMapApp").service("regionService",["$localStorage","Region",function(a,b){this.regions=[],this.getRegions=function(){return this.regions},this.clear=function(){regions.length=0},this.drawingManager=null,this.setDrawingManager=function(a){this.drawingManager=a},this.setEditable=function(a){for(var b=0;b<this.regions.length;b++)this.regions[b].overlay.setEditable(a)},this["delete"]=function(b){var c=this.regions.indexOf(b);c>-1&&(this.regions.splice(c,1),a.regions.splice(c,1)),b.map=null},this.add=function(a,c,d){d.type=a,d.overlay=c;var e=new b(d),f=this.regions.push(e)-1;return this.saveRegion(e),f};var c=function(b){a.regions[b.saveIndex]=b.toSaveObj()},d="1.0.3";if(a.regionsVersion!==d&&(delete a.regions,a.regions=[],a.regionsVersion=d),a.regions.length)for(var e=0;e<a.regions.length;e++){var f=a.regions[e];f.saveIndex=e,f.change=c,this.regions.push(new b(f))}this.saveRegion=function(b){a.regions.push(b.toSaveObj())}}]),angular.module("wardMapApp").service("peopleService",function(){var a=[],b={},c={},d=[];this.people=[],this.households=[],this.addPerson=function(d,e){if(b[e.id]){if("Spouse"==d.position){var f=b[e.id].name.split(","),g=d.name.split(",");f[0]==g[0]?b[e.id].name=f[0]+","+f[1]+" &"+g[1]:b[e.id].name+=" & "+d.name}}else b[e.id]=e,c[e.id]=[],"Head of Household"==d.position&&(b[e.id].name=d.name);var h=a.push(d);c[e.id].push(h),this.personMatchesFilter(d)&&(this.people.push(d),(this.households.length<1||this.households[this.households.length-1].id!=e.id)&&this.households.push(b[e.id]));
},this.getHouseholdDetail=function(a){return b[a]},this.getHouseholdMembers=function(a){return c[a]},this.addFilter=function(a,b,c){d.push({field:a,include:b,exclude:c})},this.clearFilters=function(){d.splice(0,d.length)},this.personMatchesFilter=function(a){for(var b=!0,c=0;c<d.length;c++)void 0!==typeof a[d[c].field]&&void 0!==typeof d[c].include&&d[c];return b}}),angular.module("wardMapApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("wardMapApp").controller("NavigationCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),angular.module("wardMapApp").directive("openMembershipFile",["peopleService",function(a){var b=function(a){var b=new Date,c=new Date(a),d=b.getFullYear()-c.getFullYear(),e=b.getMonth()-c.getMonth();return(0>e||0===e&&b.getDate()<c.getDate())&&d--,d},c=function(){for(var a,b="",c=0;c<arguments.length;c++)"string"==typeof arguments[c]&&(a=arguments[c].trim(),a.length>0&&(b.length>0&&(b+=" "),b+=a));return b},d={indivId:"Indiv ID",fullName:"Full Name",preferredName:"Preferred Name",headOfHouseId:"HofH ID",householdPosition:"HH Position",householdOrder:"HH Order",householdPhone:"Household Phone",individualPhone:"Individual Phone",householdEmail:"Household E-mail",individualEmail:"Individual E-mail",street1:"Street 1",street2:"Street 2",district:"D/P",city:"City",postal:"Postal",state:"State/Prov",country:"Country",street1_2:"2-Street 1",street2_2:"2-Street 2",district_2:"2-District or Prefecture",city_2:"2-City",postal_2:"2-Zip",state_2:"2-State or Province",country_2:"2-Country",wardGeoCode:"Ward Geo Code",stakeGeoCode:"Stake Geo Code",gender:"Sex",dateBorn:"Birth",dateBaptized:"Baptized",dateConfirmed:"Confirmed",dateEndowed:"Endowed",dateRecommendExpiration:"Rec Exp",priesthood:"Priesthood",servedMission:"Mission",isMarried:"Married",spouseIsMember:"Spouse Member",isSealedToSpouse:"Sealed to Spouse",isSealedToPriorSpouse:"Sealed to Prior",headOfHousehold:"Head of Household",spouse:"Spouse",other:"Other",male:"Male",female:"Female",apostle:"Apostle",highPriest:"High Priest",seventy:"Seventy",elder:"Elder",priest:"Priest",teacher:"Teacher",deacon:"Deacon",yes:"Yes",no:"No",notApplicable:"N/A",single:"Single",married:"Married"},e=function(e){var f=Papa.parse(e,{header:!0}),g=[],h={},i=d;f=f.data;for(var j=0;j<f.length;j++){var k="undefined"==typeof f[j][i.headOfHouseId]?j:f[j][i.headOfHouseId],l=b(f[j][i.dateBorn]),m=""==f[j][i.dateConfirmed]?null:b(f[j][i.dateConfirmed]),n=m?l-m:null,o=""==f[j][i.dateEndowed]?null:b(f[j][i.dateEndowed]),p=""==f[j][i.dateRecommendExpiration]?null:b(f[j][i.dateRecommendExpiration])<0,q=f[j][i.isMarried]==i.married,r=q?f[j][i.spouseIsMember]==i.yes:null,s=q?f[j][i.isSealedToSpouse]==i.yes:null,t={id:k,address1:c(f[j][i.street1],f[j][i.street2],f[j][i.district],f[j][i.city],f[j][i.state],f[j][i.postal]),address2:c(f[j][i.street1_2],f[j][i.street2_2],f[j][i.district_2],f[j][i.city_2],f[j][i.state_2],f[j][i.postal_2]),phone:f[j][i.householdPhone],email:f[j][i.householdEmail]},u={householdId:k,name:f[j][i.preferredName],phone:f[j][i.individualPhone],email:f[j][i.individualEmail],position:f[j][i.householdPosition],gender:f[j][i.gender],age:l,yearsMember:m,memberSinceAge:n,yearsEndowed:o,currentRecommend:p,priesthood:f[j][i.priesthood],mission:f[j][i.servedMission]==i.yes,married:q,spouseMember:r,sealedToSpouse:s};h[k]||(h[k]=t),g.push(u),a.addPerson(u,t)}return!0};return{template:'<input type="file" accept="text/csv,text/plain,text/tsv,application/vnd.ms-excel"><script type="text/javascript">$(":file").filestyle({input:false,buttonText:"Load CSV File",badge:false});</script>',restrict:"E",link:function(a,b,c){b.on("change",function(b){var c=((b.srcElement||b.target).files[0],new FileReader);c.onload=function(b){var c=e(b.target.result);a.$apply(c===!0?function(){a.complete()}:function(){a.error("File data not recognized")})},c.readAsText((b.srcElement||b.target).files[0])})},scope:{complete:"=onComplete",error:"=onError"}}}]),angular.module("wardMapApp").service("geocoderService",["$localStorage","$q","$timeout","$rootScope",function(a,b,c,d){var e=function(){var b="1.0.2";if(a.locationsVersion!==b)if("1.0.1"===a.locationsVersion){for(var c in a.locations)a.locations[c].p=!1;a.locationsVersion="1.0.2"}else delete a.locations,delete a.locationsTypes,a.locationsVersion=b,a.locations={},a.locationsTypes=[];for(var d=a.locationsTypes,e=[],f=1,c=0;32>c;c++)e.push(f);var g=function(a){for(var b=[],c=0;c<d.length;c++)a|e[c]&&b.push(d[c]);return b};return{getLocalLocation:function(b,c){if("undefined"==typeof a.locations[b])return!1;var d=a.locations[b];g(d.t);return{types:d.t,latitude:d.a,longitude:d.o,formattedAddress:d.d,partial:d.p,id:c}},setLocalLocation:function(b,c){if(_.isUndefined(c.types)||_.isUndefined(c.latitude)||_.isUndefined(c.longitude)||_.isUndefined(c.formattedAddress))throw console.log(c),"Malformed geocode data. Expected {type, latitude, longitude, formattedAddress}";a.locations[b]={t:c.types,a:c.latitude,o:c.longitude,p:"undefined"==typeof c.partial?!1:c.partial,d:c.formattedAddress}},purgeLocalLocation:function(b){"undefined"!=typeof a.locations[b]&&delete a.locations[b]},purgeLocalLocations:function(){a.locations={},a.locationsType=[]}}},f=e(),g=[],h=200,i=h,j=2e3,k=10,l=new google.maps.Geocoder,m=!1,n=function(a,c){var d=b.defer();return g.push({address:a,id:c,d:d}),m||(m=!0,i=h,o()),d.promise},o=function(){var a=g.shift(),b=f.getLocalLocation(a.address,a.id);b!==!1?(a.d.resolve(b),g.length?c(o,k):m=!1):l.geocode({address:a.address},function(b,d){if(d===google.maps.GeocoderStatus.OK){var e={types:b[0].types,latitude:b[0].geometry.location.lat(),longitude:b[0].geometry.location.lng(),formattedAddress:b[0].formatted_address,partial:b[0].partial_match};f.setLocalLocation(a.address,e),e.id=a.id,a.d.resolve(e)}else d===google.maps.GeocoderStatus.ZERO_RESULTS?a.d.reject({type:"zero",id:a.id,message:"Zero results for geocoding address "+a.address}):d===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?(g.unshift(a),i>=j?a.d.reject({type:"limit",id:a.id,message:"It seems that the 24-hour geocoding limit has been reached. Try again after 24 hours."}):i+=100):a.d.reject(d===google.maps.GeocoderStatus.REQUEST_DENIED?{type:"denied",id:a.id,message:"Request denied for geocoding address "+a.address}:{type:"invalid",id:a.id,message:"Invalid request for geocoding: status="+d+", address="+a.address});g.length?c(o,i):m=!1}),d.$$phase||d.$apply()};return{geocodeAddress:function(a,b){return n(a,b)},refresh:function(a,b){return f.purgeLocalLocation(a),n(a,b)},purge:function(){f.purgeLocalLocations()},manual:function(a,b,c){var d={type:["manual"],latitude:b,longitude:c,formattedAddress:a};return f.setLocalLocation(a,d),d}}}]),angular.module("wardMapApp").controller("MapCtrl",["$scope","peopleService","regionService",function(a,b,c){a.map={center:{latitude:0,longitude:0},zoom:1,control:{},bounds:null},a.households=b.households,a.regions=c.regions,a.errors=[],a.events={click:function(a,c,d){console.log(d.id),console.log(b.getHouseholdDetail(d.id))}},a.drawingManagerOptions={drawingMode:null,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.POLYGON,google.maps.drawing.OverlayType.CIRCLE,google.maps.drawing.OverlayType.RECTANGLE]},circleOptions:{strokeWeight:1,clickable:!1,fillOpacity:.5},polygonOptions:{strokeWeight:1,clickable:!1,fillOpacity:.5},rectangleOptions:{strokeWeight:1,clickable:!1,fillOpacity:.5}},a.drawingManagerControl={getDrawingManager:null},a.$watch("drawingManagerControl.getDrawingManager",function(){if("function"==typeof a.drawingManagerControl.getDrawingManager){var b=a.drawingManagerControl.getDrawingManager();google.maps.event.addListener(b,"overlaycomplete",function(b){c.add(b.type,b.overlay,{color:"#"+Math.floor(16777215*Math.random()).toString(16),map:a.map.control.getGMap()});a.$apply()})}}),a.$watch("regions.length",function(){var b,c=a.map.control.getGMap(),d=a.regions[0];d&&(b=new google.maps.LatLngBounds(new google.maps.LatLng(d.bounds.getSouthWest().lat(),d.bounds.getSouthWest().lng()),new google.maps.LatLng(d.bounds.getNorthEast().lat(),d.bounds.getNorthEast().lng())),d.map=c);for(var e=1;e<a.regions.length;e++)a.regions[e].map=c,b.union(a.regions[e].bounds);if(b){var f={northeast:{latitude:b.getNorthEast().lat(),longitude:b.getNorthEast().lng()},southwest:{latitude:b.getSouthWest().lat(),longitude:b.getSouthWest().lng()}};a.map.bounds=f}})}]),angular.module("wardMapApp").controller("regionCtrl",["$scope","regionService",function(a,b){a.regions=b.regions,a.rowClick=function(a){console.log(a)},a.onError=function(a){alert(a)},a.onComplete=function(){},a.toggleItem=function(a){a.visible=!a.visible},a.deleteItem=function(a){confirm("Are you sure you want to delete this region?")&&b["delete"](a)},a.editItem=function(a){a.editable=!a.editable},a.zoomToItem=function(a){a.zoom()},a.zoomToRegions=function(){if(a.regions.length>0){for(var b=new google.maps.LatLngBounds(new google.maps.LatLng(a.regions[0].bounds.getSouthWest().lat(),a.regions[0].bounds.getSouthWest().lng()),new google.maps.LatLng(a.regions[0].bounds.getNorthEast().lat(),a.regions[0].bounds.getNorthEast().lng())),c=1;c<a.regions.length;c++)b=b.union(a.regions[c].bounds);var d=a.regions[0].map;d.fitBounds(b)}},a.deleteRegions=function(){if(a.regions.length>0&&confirm("Are you sure you want to delete all regions?"))for(;a.regions.length;)b["delete"](a.regions[0])},a.gridOptions={data:"regions",rowTemplate:'<div ng-click="rowClick(row.entity)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}">\r\n	<div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div>\r\n	<div ng-cell></div>\r\n</div>',rowHeight:38,columnDefs:[{field:"name",displayName:"Name",enableCellEdit:!0},{field:"color",displayName:"Color",cellTemplate:'<div class="ngCellText"><spectrum-colorpicker class="colt+col.index" ng-model="COL_FIELD"></spectrum-colorpicker></div>'},{displayName:"Actions",cellTemplate:'<div class="ngCellText"><span title="{{row.entity.visible?\'hide\':\'show\'}}" class="fa {{row.entity.visible?\'fa-eye\':\'fa-eye-slash\'}}" ng-click="$event.stopPropagation();toggleItem(row.entity);"></span> <span title="delete" class="fa fa-remove" ng-click="$event.stopPropagation();deleteItem(row.entity);"></span> <span title="edit" class="fa fa-edit {{row.entity.editable?\'selected\':\'\'}}" ng-click="$event.stopPropagation();editItem(row.entity);"></span> <span title="zoom to" class="fa fa-search-plus" ng-click="$event.stopPropagation();zoomToItem(row.entity);"></span></div>'}]}}]),angular.module("wardMapApp").directive("openRegionFile",["regionService",function(a){function b(c,d){switch(c.type){case"Polygon":for(var e=[],f=0;f<c.coordinates.length;f++){for(var g=[],h=0;h<c.coordinates[f].length;h++)g.push(new google.maps.LatLng(c.coordinates[f][h][1],c.coordinates[f][h][0]));e.push(g)}var i=new google.maps.Polygon({paths:e,strokeWeight:1}),j={color:"#"+Math.floor(16777215*Math.random()).toString(16)};"undefined"!=typeof d&&"undefined"!=typeof d.name&&(j.name=d.name),a.add(google.maps.drawing.OverlayType.POLYGON,i,j);break;case"MultiPolygon":for(var f=0;f<c.coordinates.length;f++){var k=b(c.coordinates[f]);if(k!==!0)return k}break;case"GeometryCollection":for(var f=0;f<c.geometries.length;f++){var k=b(c.geometries[f]);if(k!==!0)return k}break;case"Feature":var k=b(c.geometry,c.properties);if(k!==!0)return k;break;case"FeatureCollection":for(var f=0;f<c.features.length;f++){var k=b(c.features[f]);if(k!==!0)return k}break;case"Point":return"Point type is not supported";case"MultiPoint":return"MultiPoint type is not supported";case"LineString":return"LineString type is not supported";case"MultiLineString":return"MultiLineString type is not supported";default:return"Error processing file"}return!0}return{template:'<input type="file" accept="application/vnd.google-earth.kml+xml"><script type="text/javascript">$(":file").filestyle({input:false,buttonText:"Load KML File",badge:false});</script>',restrict:"E",link:function(a,c,d){c.on("change",function(c){var d=(c.srcElement||c.target).files[0],e=new FileReader;e.onload=function(c){var d=(new DOMParser).parseFromString(c.target.result,"text/xml"),e=toGeoJSON.kml(d);e=b(e),e===!0?a.$apply(function(){"function"==typeof a.complete&&a.complete()}):(console.log(e),a.$apply(function(){"function"==typeof a.error&&a.error("Error reading file: "+e)}))},e.readAsText(d)})},scope:{complete:"=onComplete",error:"=onError"}}}]),angular.module("wardMapApp").factory("Region",function(){function a(a){if(a.overlay)if(this.type=a.type,"1.0.1"==a.overlay.version)switch(a.overlay.type){case google.maps.drawing.OverlayType.CIRCLE:this.overlay=new google.maps.Circle({center:new google.maps.LatLng(a.overlay.center_lat,a.overlay.center_lng),radius:a.overlay.radius,strokeWeight:1});break;case google.maps.drawing.OverlayType.RECTANGLE:this.overlay=new google.maps.Rectangle({bounds:new google.maps.LatLngBounds(new google.maps.LatLng(a.overlay.sw_lat,a.overlay.sw_lng),new google.maps.LatLng(a.overlay.ne_lat,a.overlay.ne_lng)),strokeWeight:1});break;case google.maps.drawing.OverlayType.POLYGON:for(var c=[],d=0;d<a.overlay.paths.length;d++){for(var e=[],f=0;f<a.overlay.paths[d].length;f++)e.push(new google.maps.LatLng(a.overlay.paths[d][f].lat,a.overlay.paths[d][f].lng));c.push(e)}this.overlay=new google.maps.Polygon({paths:c,strokeWeight:1})}else this.overlay=a.overlay;this._name="untitled";var g=this;switch(this.changeListener=function(){a.change&&a.change(g)},this._map=null,this._overlaySaveObj=function(){var a=null;switch(this.type){case google.maps.drawing.OverlayType.CIRCLE:a={version:b,type:this.type,center_lat:this.overlay.getCenter().lat(),center_lng:this.overlay.getCenter().lng(),radius:this.overlay.getRadius()};break;case google.maps.drawing.OverlayType.RECTANGLE:a={version:b,type:this.type,ne_lat:this.overlay.getBounds().getNorthEast().lat(),ne_lng:this.overlay.getBounds().getNorthEast().lng(),sw_lat:this.overlay.getBounds().getSouthWest().lat(),sw_lng:this.overlay.getBounds().getSouthWest().lng()};break;case google.maps.drawing.OverlayType.POLYGON:for(var a={type:this.type,version:b,paths:[]},c=0;c<this.overlay.getPaths().getLength();c++){for(var d=[],e=0;e<this.overlay.getPaths().getAt(c).getLength();e++)d.push({lat:this.overlay.getPaths().getAt(c).getAt(e).lat(),lng:this.overlay.getPaths().getAt(c).getAt(e).lng()});a.paths.push(d)}}return a},this.saveIndex=null,this.zoom=function(){this._map.fitBounds(this.bounds)},this.toSaveObj=function(){return{name:this.name,color:this.color,visible:this.visible,editable:this.editable,saveIndex:this.saveIndex,changed:this.changed,type:this.type,overlay:this._overlaySaveObj()}},this.contains=function(a){switch(this.type){case google.maps.drawing.OverlayType.CIRCLE:return this.overlay.getBounds().contains(a)&&google.maps.geometry.spherical.computeDistanceBetween(this.overlay.getCenter(),a)<=this.overlay.getRadius();case google.maps.drawing.OverlayType.RECTANGLE:return this.overlay.getBounds().contains(a);case google.maps.drawing.OverlayType.POLYGON:return google.maps.geometry.poly.containsLocation(a,this.overlay)}},this.type){case google.maps.drawing.OverlayType.CIRCLE:google.maps.event.addListener(this.overlay,"radius_changed",this.changeListener),google.maps.event.addListener(this.overlay,"center_changed",this.changeListener);break;case google.maps.drawing.OverlayType.RECTANGLE:google.maps.event.addListener(this.overlay,"bounds_changed",this.changeListener);break;case google.maps.drawing.OverlayType.POLYGON:for(var d=0;d<this.overlay.getPaths().getLength();d++){var e=this.overlay.getPaths().getAt(d);google.maps.event.addListener(e,"insert_at",this.changeListener),google.maps.event.addListener(e,"remove_at",this.changeListener),google.maps.event.addListener(e,"set_at",this.changeListener)}}a&&(a.name&&(this.name=a.name),a.map&&(this.map=a.map),a.editable&&(this.editable=a.editable),"undefined"!=typeof a.color&&(this.color=a.color),"undefined"!=typeof a.visible&&(this.visible=a.visible),"undefined"!=typeof a.saveIndex&&(this.saveIndex=a.saveIndex))}var b="1.0.1";return Object.defineProperties(a.prototype,{name:{get:function(){return this._name},set:function(a){this._name=a,this.changeListener()}},map:{get:function(){return this._map},set:function(a){this._map=a,this.overlay&&this.overlay.setMap(a)}},visible:{get:function(){return this.overlay&&null!=this.overlay.map},set:function(a){this.overlay.setMap(a?this._map:null),this.changeListener()}},color:{get:function(){return this.overlay?this.overlay.fillColor:null},set:function(a){this.overlay.setOptions({fillColor:a}),this.changeListener()}},editable:{get:function(){return this.overlay&&this.overlay.getEditable()},set:function(a){this.overlay.setEditable(a),this.changeListener()}},bounds:{get:function(){var a=null;if(this.overlay)if("undefined"!=typeof this.overlay.getBounds)a=this.overlay.getBounds();else if("undefined"!=typeof this.overlay.getPaths)for(var b=this.overlay.getPaths().getAt(0),c=0;c<b.getLength();c++)null==a?a=new google.maps.LatLngBounds(b.getAt(c)):a.extend(b.getAt(c));else a=new google.maps.LatLngBounds;return a}}}),a}),angular.module("wardMapApp").controller("AnalyzeCtrl",["$scope","regionService","peopleService",function(a,b,c){a.regions=b.regions,a.people=c.people,a.filteredPeople=[],a.selectedRegion={},a.filteredData=[],a.tableColumns=[{field:"name",displayName:"Name"},{field:"address1",displayName:"Address"},{field:"phone",displayName:"Phone"},{field:"email",displayName:"E-mail"},{field:"formattedAddress",displayName:"Geocoded Address"},{field:"geocodeType",displayName:"Geocode Type"}],a.gridOptions={data:"filteredPeople",showColumnMenu:!0,rowTemplate:'<div ng-click="rowClick(row.entity)" ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}">\r\n	<div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div>\r\n	<div ng-cell></div>\r\n</div>',columnDefs:"tableColumns"};var d=[{name:"People",condition:[],filter:function(a){return!0},count:null},{name:"Members",condition:["yearsMember"],filter:function(a){return a.yearsMember>0},count:null},{name:"Young Men",condition:["age","gender"],filter:function(a){return a.age>=12&&a.age<=18&&"male"==a.gender},count:null}],e=[];a.filters=[],a.MAX_VALUE_COUNT=4;var f=function(){console.log("selecting filters");for(var b={},f=c.people[0],g=Object.keys(f),h=0;h<g.length;h++)for(var i=0;i<c.people.length;i++){var j=g[h],k=c.people[i][j];if("undefined"==typeof b[j]?(b[j]={numValues:1,type:typeof k},b[j][k]=1):"undefined"==typeof b[j][k]?(b[j][k]=1,b[j].numValues++):b[j][k]++,b[j].numValues>a.MAX_VALUE_COUNT)break}for(var j in b){var l=b[j].numValues;if(l>1&&l<a.MAX_VALUE_COUNT){var m=b[j].type;for(var k in b[j])if("numValues"!=k&&"type"!=k){var n=k;"boolean"==m&&("true"===k?n=!0:"false"===k?n=!1:"null"===k&&(n=null)),e.push({name:j+": "+k,condition:[],field:j,testValue:n,filter:function(a){return"undefined"!=typeof a&&"undefined"!=typeof a[this.field]&&a[this.field]===this.testValue}})}}}for(var h=0;h<d.length;h++){var o=d[h];if("undefined"!=typeof o.condition&&o.condition.length>0){for(var p=!0,i=0;i<o.condition.length;i++)if("undefined"==typeof b[o.condition[i]]){p=!1;break}p&&e.push(o)}}},g=function(){var b=[];a.filteredPeople.length=0;for(var d=0;d<c.households.length;d++)if(a.selectedRegion&&"undefined"!=typeof a.selectedRegion.contains&&a.selectedRegion.contains(new google.maps.LatLng(c.households[d].latitude,c.households[d].longitude))){b.push(c.households[d]);for(var e=c.getHouseholdMembers(c.households[d].id),f=0;f<e.length;f++)a.filteredPeople.push(c.people[e[f]])}for(var d=0;d<a.filters.length;d++){a.filters[d].count=0;for(var g=0;g<b.length;g++)for(var e=c.getHouseholdMembers(b[g].id),f=0;f<e.length;f++)a.filters[d].filter(c.people[e[f]])&&a.filters[d].count++}};a.$watch("selectedRegion",function(){c.people.length>0&&(0==e.length&&(f(),a.filters=e),g())})}]);